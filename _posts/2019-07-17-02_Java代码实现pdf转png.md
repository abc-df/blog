---
title: java代码实现pdf转png
tags: java
key: 
modify_date: 2019-07-17 20:00:00 +08:00
---

# java代码实现pdf转png
```java
/**
     * @return RestInfo
     * @Author txl
     * @Description //TODO  pdf 转 png
     * @Date 09:23 2019/7/02
     * @Param files
     **/
    @PostMapping("/sp/pdfToPng")
    public File pdfToPng(MultipartFile[] files) throws Exception {
        for (MultipartFile file : files) {
            try {
                int n;
                File f = null;
                // 创建文件
                f = new File(file.getOriginalFilename());
                try (InputStream in = file.getInputStream();
                     OutputStream os = new FileOutputStream(f)) {
                    byte[] buffer = new byte[4096];
                    while ((n = in.read(buffer, 0, 4096)) != -1) {
                        os.write(buffer, 0, n);
                    }
                    BufferedReader bufferedReader = new BufferedReader(new FileReader(f));
                    bufferedReader.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }

                FileInputStream instream = new FileInputStream(f);
                InputStream byteInputStream = null;
                try {
                    PDDocument doc = PDDocument.load(instream);
                    PDFRenderer renderer = new PDFRenderer(doc);
                    List<BufferedImage> piclist = new ArrayList<BufferedImage>();
                    int pageCount = doc.getNumberOfPages();
                    System.out.println("pageCount=" + pageCount);
                    if (pageCount > 0) {
                        for (int i = 0; i < pageCount; i++) {
                            BufferedImage image = renderer.renderImage(i, 2.0f);
                            piclist.add(image);
                            image.flush();
                            ByteArrayOutputStream bs = new ByteArrayOutputStream();
                            ImageOutputStream imOut;
                            imOut = ImageIO.createImageOutputStream(bs);
                            ImageIO.write(image, "jpg", imOut);
                            byteInputStream = new ByteArrayInputStream(bs.toByteArray());
                            byteInputStream.close();
                        }

                        instream.close();
                        File file1 = yPic(piclist, f.toString().substring(0, f.toString().lastIndexOf(".")) + ".jpg");
                        //删除pdf
                        deleteFile(f);
                        return file1;
                    }
                } catch (IOException e) {
                    e.printStackTrace();
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
        return null;
    }


    /**
     * @return File
     * @Author txl
     * @Description //TODO  合并图片
     * @Date 09:23 2019/7/02
     * @Param piclist, outPath
     **/
    public static File yPic(List<BufferedImage> piclist, String outPath) {


        if (piclist == null || piclist.size() <= 0) {
            System.out.println("图片数组为空!");
            return null;
        }
        try {
            int height = 0,
                    width = 0,
                    _height = 0,
                    __height = 0,
                    picNum = piclist.size();
            File fileImg = null;
            int[] heightArray = new int[picNum];
            BufferedImage buffer = null;
            List<int[]> imgRGB = new ArrayList<int[]>();
            int[] _imgRGB;
            for (int i = 0; i < picNum; i++) {
                buffer = piclist.get(i);
                heightArray[i] = _height = buffer.getHeight();
                if (i == 0) {
                    width = buffer.getWidth();
                }
                height += _height ;
                _imgRGB = new int[width * _height];
                _imgRGB = buffer.getRGB(0, 0, width, _height, _imgRGB, 0, width);
                imgRGB.add(_imgRGB);
            }
            //分页线
            int pageH=20;
            BufferedImage bufferedImage = new BufferedImage(
                    width,
                    pageH,
                    BufferedImage.TYPE_INT_RGB
            );
            Graphics g = bufferedImage.getGraphics();
            //设置颜色
            g.setColor(Color.LIGHT_GRAY);
            //填充
            g.fillRect(0, 0, bufferedImage.getWidth(), bufferedImage.getHeight());
            //以png方式写入，可改成jpg其他图片
            int[] pageRFB;
            pageRFB = new int[width * pageH];
            pageRFB = bufferedImage.getRGB(0, 0, width, pageH, pageRFB, 0, width);
            _height = 0;
            BufferedImage imageResult = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
            for (int i = 0; i < picNum; i++) {
                __height = heightArray[i];
                if (i != 0) {
                    _height += __height;
                }

                imageResult.setRGB(0, _height, width, __height, imgRGB.get(i), 0, width); // 写入流中
                if (i != 0) {
                    imageResult.setRGB(0, _height-pageH/2, width, pageH, pageRFB, 0, width);
                }
            }

            System.out.println("outPath===" + outPath);
            File outFile = new File(outPath);
            ImageIO.write(imageResult, "jpg", outFile);// 写图片
            return outFile;
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;
    }
```