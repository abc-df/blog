---
title: B树、B-树、B+树、黑红树
tags: java
key: 
modify_date: 2019-07-17 20:00:00 +08:00
---

在学习Mysql性能优化时候看到了索引的实现采用B树。
# 什么是索引
用索引可快速访问数据库表中的特定信息。索引是对数据库表中一列或多列的值进行排序的一种结构，索引它包含一个表中某些列的值以及记录对应的地址，并且把这些值存储在一个数据结构中。例如 我们需要从1万条数据中查询出姓名为Jpan的用户。
如果不使用索引，我们需要逐条查询Jpan的用户（全盘查询），遍历一万次。
索引（索引是一种数据结构）是链表结构。每个节点存储的是关键字字段以及该关键字字段在数据库表的对应的记录的地址。而这些节点是根据name属性排序的（即根据字母顺序排序）。因此，当我们执行上面说的查找名为“Jpan”的sql语句时，数据库会通过该索引来查询，因为该链表是有序排列的，在我们找到第一个Jpan时，接着查询下一个，直到查询到不是Jpan时我们就不需要查询了，比如1000次查询到Jpan，最后一个Jpan是1300，1300--1万数据则不需要查询。

# 为啥索引使用 b+树？
    1. 数据库索引采用B+树的主要原因是B树在提高了磁盘IO性能的同时并没有解决元素遍历的效率低下的问题（磁盘IO性能☞ 磁盘过大不能全部读取到内存当中，采用预读（分片读取），B树解决了分片读取，但是没有解决多次遍历问题）。
    2. 正是为了解决这个问题，B+树应运而生。
    3. B+树只要遍历叶子节点就可以实现整棵树的遍历。而且在数据库中基于范围的查询是非常频繁的，而B树不支持这样的操作（或者说效率太低）。

举例 查询2到4范围的数字：
B树：查询到2，重新遍历查询3，重新遍历查询4
B+树: 查询到3，通过指针查询3，查询4


 <!--more-->

# B树、B-树、B+树、红黑树
B-tree树即B树，B即Balanced，平衡的意思。因为B树的原英文名称为B-tree，而国内很多人喜欢把B-tree译作B-树，其实，这是个非常不好的直译，很容易让人产生误解。如人们可能会以为B-树是一种树，而B树又是另一种树。而事实上是，B-tree就是指的B树。特此说明。
首先，B树的创建就是为了优化数据库查找，如果采用二叉查找树（时间复杂度只要LogN）来进行查找，那么在磁盘进行I/O操作时，（数据太大需要进行分页）每个磁盘页对应一个节点；最坏情况：查找次数等于输的高度（时间复杂度LogN）

## B树（B-树）
B-树就是我们平常说的B树，不要读成B减树了，它在文件系统中很有用（原因之前已经介绍了），我们先来看下一个m阶的Bs树具有如下几个特性：

1. 根节点至少有两个子女
2. 每个中间节点都包含k-1个元素和k个孩子，其中m/2<=k<=m
3. 每个叶子节点都包含k-1元素，其中m/2<=k<=m
4. 所有的叶子节点都位于同一层
5. 每个节点的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域分划。

如mongoDB数据库使用，单次查询平均快于Mysql

## B+树

b+树，是b树的一种变体，查询性能更好。m阶的b+树的特征：

1. 有n棵子树的非叶子结点中含有n个关键字（b树是n-1个），这些关键字不保存数据，只用来索引，所有数据都保存在叶子节点（b树是每个关键字都保存数据）。
2. 所有的叶子结点中包含了全部关键字的信息，及指向含这些关键字记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接。
3. 所有的非叶子结点可以看成是索引部分，结点中仅含其子树中的最大（或最小）关键字。
4. 通常在b+树上有两个头指针，一个指向根结点，一个指向关键字最小的叶子结点。
5. 同一个数字会在不同节点中重复出现，根节点的最大元素就是b+树的最大元素。

b+树相比于b树的查询优势：

1. b+树的中间节点不保存数据，所以磁盘页能容纳更多节点元素，更“矮胖”；
2. b+树查询必须查找到叶子节点，b树只要匹配到即可不用管元素位置，因此b+树查找更稳定（并不慢）；
3. 对于范围查找来说，b+树只需遍历叶子节点链表即可，b树却需要重复地中序遍历；


## 红黑树

红黑树是每个节点都带有颜色属性的二叉查找树，颜色或红色或黑色。在二叉查找树强制一般要求以外，对于任何有效的红黑树我们增加了如下的额外要求:

1. 节点是红色或黑色。

2. 根节点是黑色。

3. 每个叶节点是黑色的。

4. 每个红色节点的两个子节点都是黑色。(从每个叶子到根的所有路径上不能有两个连续的红色节点)

5. 从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点。

对于给定的黑色高度为n的红黑树，从根到叶结点的简单路径的最短长度为n-1，最大长度为2(n-1)。

例如 linux中进程的调度用的是红黑树


